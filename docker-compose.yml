version: "3.8"

# Auto-generated mapping of all env vars from env files
x-env: &all_env
  AUTOEURO_API_KEY: ${AUTOEURO_API_KEY}
  AWS_ACCESS_KEY_ID: ${AWS_ACCESS_KEY_ID}
  AWS_BUCKET_NAME: ${AWS_BUCKET_NAME}
  AWS_REGION: ${AWS_REGION}
  AWS_S3_BUCKET: ${AWS_S3_BUCKET}
  AWS_SECRET_ACCESS_KEY: ${AWS_SECRET_ACCESS_KEY}
  BEELINE_SMS_PASS: ${BEELINE_SMS_PASS}
  BEELINE_SMS_SENDER: ${BEELINE_SMS_SENDER}
  BEELINE_SMS_USER: ${BEELINE_SMS_USER}
  CMS_PORT: ${CMS_PORT}
  DADATA_API_KEY: ${DADATA_API_KEY}
  DATABASE_URL: ${DATABASE_URL}
  JWT_SECRET: ${JWT_SECRET}
  LAXIMO_DOC_LOGIN: ${LAXIMO_DOC_LOGIN}
  LAXIMO_DOC_PASSWORD: ${LAXIMO_DOC_PASSWORD}
  LAXIMO_LOGIN: ${LAXIMO_LOGIN}
  LAXIMO_PASSWORD: ${LAXIMO_PASSWORD}
  NEXTAUTH_SECRET: ${NEXTAUTH_SECRET}
  NEXTAUTH_URL: ${NEXTAUTH_URL}
  NEXT_PUBLIC_FRONTEND_ORIGIN: ${NEXT_PUBLIC_FRONTEND_ORIGIN}
  ONEC_API_TOKEN: ${ONEC_API_TOKEN}
  ONEC_IP_ALLOWLIST: ${ONEC_IP_ALLOWLIST}
  ONEC_MAX_BATCH_SIZE: ${ONEC_MAX_BATCH_SIZE}
  ONEC_RATE_LIMIT_PER_MIN: ${ONEC_RATE_LIMIT_PER_MIN}
  ONEC_STRICT_VALIDATION: ${ONEC_STRICT_VALIDATION}
  OPENAI_API_KEY: ${OPENAI_API_KEY}
  OPENAI_MODEL: ${OPENAI_MODEL}
  OZON_API_KEY: ${OZON_API_KEY}
  OZON_CLIENT_ID: ${OZON_CLIENT_ID}
  OZON_MOCK: ${OZON_MOCK}
  PARTSDB_URL: ${PARTSDB_URL}
  POLZA_AI_API_KEY: ${POLZA_AI_API_KEY}
  POLZA_AI_BASE_URL: ${POLZA_AI_BASE_URL}
  POLZA_AI_MODEL: ${POLZA_AI_MODEL}
  S3_ENDPOINT: ${S3_ENDPOINT}
  SMTP_FROM: ${SMTP_FROM}
  SMTP_HOST: ${SMTP_HOST}
  SMTP_PASS: ${SMTP_PASS}
  SMTP_PORT: ${SMTP_PORT}
  SMTP_USER: ${SMTP_USER}
  TRINITY_CLIENT_CODE: ${TRINITY_CLIENT_CODE}
  YANDEX_DELIVERY_SOURCE_STATION_ID: ${YANDEX_DELIVERY_SOURCE_STATION_ID}
  YANDEX_DELIVERY_TOKEN: ${YANDEX_DELIVERY_TOKEN}
  YANDEX_GEOSUGGEST_API_KEY: ${YANDEX_GEOSUGGEST_API_KEY}
  YANDEX_MAPS_API_KEY: ${YANDEX_MAPS_API_KEY}
  YOOKASSA_SECRET_KEY: ${YOOKASSA_SECRET_KEY}
  YOOKASSA_SHOP_ID: ${YOOKASSA_SHOP_ID}
  ZZAP_EMAIL: ${ZZAP_EMAIL}
  ZZAP_PASSWORD: ${ZZAP_PASSWORD}
  ZZAP_VISION_MODEL: ${ZZAP_VISION_MODEL}

services:
  protekauto-cms:
    env_file:
      - stack.env
      - stack.env.local
      - .env
    build:
      context: .
      dockerfile: Dockerfile
      args: *all_env
    ports:
      - "${CMS_PORT:-3000}:3000"
    environment: *all_env

    restart: unless-stopped
