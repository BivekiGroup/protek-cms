Доработка хамбургер-меню категорий - фиксированные размеры 600px высота с вертикальным скроллом, двухпанельная компоновка (левая 280px серый фон для списка категорий, правая flex белый фон для подкатегорий), настройка overflow для корректного отображения при большом количестве элементов - 25
Разработка функционала каталога товаров по категориям - создание GraphQL запроса GET_PRODUCTS_BY_CATEGORY, добавление типа в typeDefs.ts, реализация resolver productsByCategory с поиском категории по slug, рекурсивным сбором дочерних категорий, получением товаров с изображениями из БД и PartsIndex API - 45
Создание страницы динамического каталога catalog/[slug].tsx - полная копия функционала new-arrivals с фильтрацией по производителю и цене, сортировкой (популярность/цена/новинки), пагинацией по 24 товара, хлебными крошками, добавлением в корзину с проверкой наличия, обработкой empty state - 60
Интеграция навигации из хамбургер-меню в каталог - рефакторинг handleCategoryClick для перехода на /catalog/[slug], обновление всех точек вызова в мобильной и десктопной версиях меню, добавление закрытия меню после клика - 20
Исправление ошибок TypeScript для сборки проекта - добавление поля links в transformCategoriesToTabData (BottomHead.tsx), добавление type casting для matchingOffer.price с проверкой типа number/string и parseFloat (resolvers.ts) - 10
Исправление критических ошибок сборки проекта - удаление console.log из JSX в BottomHead.tsx:273, добавление интерфейса TabData с полями label/heading/links/categoryId/categorySlug/image/children, добавление типизации для fallbackTabData и transformCategoriesToTabData, добавление импортов PartsIndexCatalog/PartsIndexCatalogsData/PartsIndexCatalogsVariables/NavigationCategory/GET_PARTSINDEX_CATEGORIES/GET_NAVIGATION_CATEGORIES в BottomHeadOld.tsx, добавление типа YandexPickupPoint для параметра map callback в ProfileAddressWayWithMap.tsx:305, успешная финальная сборка проекта - 15
Реализация автозаполнения банковских реквизитов через DaData API - создание API endpoint /api/dadata/bank в CMS для получения данных банка по БИК, интеграция с DaData API (findById/bank), возврат данных о корреспондентском счете и названии банка, настройка CORS headers для работы с frontend - 20
Разработка автоматической генерации названия счета - реализация логики формирования названия счета по формату "последние 4 цифры номера счета + название банка" (например "3456 ПАО СБЕРБАНК"), автоматическое обновление при вводе номера счета или получении данных банка, сохранение сгенерированного названия в базу данных - 15
Рефакторинг формы банковских реквизитов в компоненте LegalEntityBankDetails - реорганизация структуры формы (2 поля для ввода: номер счета и БИК, затем 2 readonly поля: название банка и корр.счет, отдельно readonly поле для сгенерированного названия счета), добавление функции fetchBankDataByBik для автоматического запроса к DaData API при вводе 9 цифр БИК, добавление состояния загрузки fetchingBankData со спиннером, добавление кнопки "Обновить" для повторной загрузки данных банка - 35
Улучшение UX формы реквизитов - добавление визуального разделения readonly полей (серый фон bg-gray-100, cursor-not-allowed), выделение автогенерированного названия счета зеленым цветом с галочкой, условное отображение полей (название банка и корр.счет появляются только после загрузки данных по БИК), блокировка поля БИК во время загрузки данных, toast-уведомления о статусе загрузки - 20
Обновление валидации формы банковских реквизитов - удаление обязательной проверки поля name (генерируется автоматически), сохранение валидации номера счета (20 цифр), БИК (9 цифр), названия банка и корр.счета (20 цифр), добавление fallback генерации названия в handleSubmit если поле пустое, улучшенные сообщения об ошибках - 10
Рефакторинг архитектуры API endpoints - удаление всех DaData API из frontend (/pages/api/dadata/party.ts, /pages/api/dadata/bank.ts), перенос всех внешних API запросов в CMS, обновление компонента LegalEntityBankDetails для использования CMS API через динамический URL (NEXT_PUBLIC_CMS_GRAPHQL_URL), удаление DADATA_API_KEY из .env фронтенда, централизация API ключей в CMS для повышения безопасности - 15
Исправление критической уязвимости безопасности: удаленные пользователи оставались авторизованными - добавление проверки существования клиента в GraphQL resolver clientMe (выброс ошибки CLIENT_NOT_FOUND если клиент удален из БД), добавление валидации существования клиента при создании контекста для всех типов токенов (client_ID_timestamp и JWT), проверка клиента через prisma.client.findUnique в createContext функции GraphQL route.ts - 25
Реализация автоматического logout при удалении пользователя - создание хука useAuthErrorHandler для централизованной обработки ошибок аутентификации, автоматическое удаление токенов из localStorage при получении CLIENT_NOT_FOUND, отправка события authChanged для обновления UI, редирект на главную страницу, интеграция хука в компоненты ProfileSidebar и ProfileLegalEntitiesMain для немедленного разлогинивания удаленных пользователей - 20
Исправление обработки ошибки CLIENT_NOT_FOUND в resolver - добавление проверки типа ошибки в catch блоке clientMe resolver, пробрасывание оригинальной ошибки CLIENT_NOT_FOUND без изменений для корректной обработки на фронтенде (вместо замены на общую ошибку), предотвращение перехвата и замены специфичной ошибки безопасности - 5
Исправление ошибки импорта Prisma в GraphQL route - замена default импорта на именованный импорт { prisma } from '@/lib/prisma' для соответствия экспорту в prisma.ts, устранение ошибки компиляции "Export default doesn't exist in target module" - 3
Исправление проблемы: удалённые пользователи не разлогиниваются - добавление флага clientDeleted в интерфейс Context для явной пометки удалённых клиентов, установка флага clientDeleted=true вместо возврата пустого контекста при отсутствии клиента в БД, добавление проверки context.clientDeleted в resolver clientMe для немедленного выброса ошибки CLIENT_NOT_FOUND, тестирование полного цикла: удаление аккаунта админом → автоматический logout пользователя на фронтенде - 15
Отладка и улучшение обработки ошибок CLIENT_NOT_FOUND - добавление детального логирования в хук useAuthErrorHandler для отслеживания получения и обработки ошибок, логирование всех этапов: получение ошибки, проверка graphQLErrors, обнаружение CLIENT_NOT_FOUND, выполнение logout и редирект, улучшение отладки для выявления проблем с автоматическим разлогиниванием - 5
    19→Исправление критической проблемы: errorPolicy: 'ignore' блокировал обработку ошибок - обнаружение что компонент LKMenu (рендерится на всех страницах профиля) выполнял GET_CLIENT_ME с errorPolicy: 'ignore', что блокировало распространение ошибок CLIENT_NOT_FOUND, изменение errorPolicy на 'all' в LKMenu.tsx:40, добавление импорта и вызова useAuthErrorHandler в LKMenu для корректной обработки ошибок авторизации, успешное тестирование полного цикла автоматического разлогинивания при удалении аккаунта - 10
    20→Улучшение UX формы добавления юридического лица - добавление обработчика onKeyDown для поля ИНН, реализация автоматического запуска функции "Заполнить по ИНН" при нажатии клавиши Enter (при условии что ИНН содержит минимум 10 символов и не идет загрузка), добавление preventDefault для предотвращения submit формы, улучшение пользовательского опыта - теперь не обязательно кликать мышкой на кнопку - 5
    21→Реализация защиты от дублирования юридических лиц - добавление проверки на существование юр. лица с таким же ИНН у клиента перед созданием в обоих resolver'ах (createClientLegalEntity и createClientLegalEntityMe), использование prisma.clientLegalEntity.findFirst с условием clientId + inn, выброс ошибки "Юридическое лицо с таким ИНН уже существует" при попытке создать дубликат, предотвращение создания нескольких юр. лиц с одинаковым ИНН в рамках одного кабинета клиента - 10
    22→Улучшение отображения ошибок при создании/обновлении юридических лиц - изменение обработчиков onError в useMutation для показа конкретного сообщения ошибки от сервера (error.message) вместо общего текста "Ошибка создания юр. лица", теперь пользователь видит точную причину ошибки в toast-уведомлении (например "Юридическое лицо с таким ИНН уже существует"), улучшение UX при валидации данных - 5
    23→Исправление обработки ошибок в resolver createClientLegalEntityMe - изменение catch блока для проброса оригинальной ошибки вместо замены на общее сообщение "Не удалось создать юридическое лицо", добавление проверки instanceof Error для корректного проброса, теперь пользователь видит конкретную причину ошибки (например "Юридическое лицо с таким ИНН уже существует") вместо общего сообщения - 5
    24→Улучшение UX empty state на странице реквизитов - редизайн блока когда нет юридических лиц с добавлением визуальной иконки документов в красном круге, изменение заголовка на "Начните с добавления юридического лица", улучшенное описание "Для добавления банковских реквизитов сначала необходимо создать юридическое лицо. Это займет всего пару минут.", центрирование контента, добавление иконки + к кнопке "Добавить юридическое лицо", улучшение визуальной иерархии и понятности следующего шага для пользователя - 10
    25→Улучшение UX empty state для банковских реквизитов на странице profile-req - редизайн блока в LegalEntityBankDetails.tsx когда у юрлица нет реквизитов (details.length === 0), замена простого текста на визуальный empty state с иконкой пунктирного квадрата и плюса в красном круге bg-red-50, добавление заголовка "Добавьте банковские реквизиты", понятного описания и кнопки "Добавить реквизиты" с иконкой, центрирование контента, теперь пользователю сразу понятно что у юрлица нет реквизитов и что нужно их добавить - 10
    26→Добавление визуальной индикации отсутствия реквизитов в списке юрлиц - изменение кнопки "Реквизиты" для показа статуса: если реквизитов нет (bankDetails.length === 0) - кнопка становится красной с фоном bg-red-50 border-red-200 text-red-600 и текстом "Добавить реквизиты", если есть - показывает "Реквизиты (количество)" с обычным стилем, добавление условной стилизации иконки, теперь пользователю сразу видно какие юрлица требуют добавления реквизитов без необходимости открывать каждое - 10
    27→Реализация автообновления цен в корзине без перезагрузки страницы - добавление периодического обновления цен каждые 2 минуты через useEffect с setInterval в CartContext.tsx, создание функции updatePrices для повторного использования логики обновления цен, добавление состояния isUpdatingPrices, обновление типов CartState и CartContextType с новыми полями и методом updatePrices, добавление автоматической проверки цен при клике на кнопку "Оформить заказ" в handleProceedToStep2 и при клике на кнопку "Оплатить" в handleSubmit в CartSummary.tsx - теперь цены обновляются автоматически каждые 2 минуты в фоновом режиме без необходимости перезагружать страницу, а также проверяются перед оформлением заказа и оплатой, пользователь видит актуальные цены и toast-уведомления об изменениях, процесс полностью прозрачный и не требует действий от пользователя - 45
    28→Перенос функциональности "Желаемое время доставки" из страницы адресов в корзину на 2-й шаг - удаление поля deliveryTime из формы добавления/редактирования адреса в компоненте AddressFormWithPickup.tsx (удалены состояния timeSlots и isTimeOpen, UI блок селектора, поле из formData и мутаций создания/обновления адреса), добавление поля "Желаемое время доставки" в компоненты CartSummary.tsx и CartSummary2.tsx с кастомным дропдауном в едином стиле с другими полями формы (5 временных слотов: 9:00-12:00, 12:00-15:00, 15:00-18:00, 18:00-21:00, Любое время), добавление состояний selectedDeliveryTime и isTimeDropdownOpen с обработчиком клика вне дропдауна через ref, интеграция в localStorage для сохранения состояния между перезагрузками, передача deliveryTime в мутацию createOrder с добавлением в комментарий заказа, обновление GraphQL схем (typeDefs.ts: добавлено поле deliveryTime в типы Order и CreateOrderInput, schema.prisma: добавлено поле deliveryTime String? в модель Order, resolvers.ts: добавлено поле в интерфейс CreateOrderInput и в создание заказа) - теперь пользователь выбирает желаемое время доставки на втором шаге корзины при оформлении заказа, что логичнее чем хранить в настройках адреса, поле отображается в едином стиле с другими элементами формы - 45
Отображение адреса на карте при вводе - геокодирование через ymaps.geocode, метка красным домиком, центрирование карты - 25
Синхронизация адреса при редактировании - передача ID отредактированного адреса через newAddressId параметр для автообновления в корзине - 10
Исправление склонения день/дня/дней - функция pluralizeDays во всех компонентах - 10
Исправление склонения товар/товара/товаров - функция pluralizeGoods в CartInfo.tsx - 5
Перенос настроек cookies в настройки профиля - компактный блок в ProfilePersonalData.tsx с тремя переключателями, минимизация баннера cookies в правом нижнем углу - 15
Улучшение тултипа корзины - пронумерованные шаги с кружками, улучшенный дизайн и правильный текст - 5
Исправление хлебных крошек корзины - удаление лишней ссылки Каталог - 2
Добавление скролла к эндпоинтам 1С - клик на эндпоинт в списке скроллит к его секции - 10
Добавление legal_entity_id в API заказов 1С - поле legalEntityId в Order schema, сохранение в resolver, вывод в buyer - 15
Редизайн процесса регистрации с автогенерацией логина/пароля и отправкой на email - 90
Исправление TypeScript ошибки в типе setDeliveryType компонента Tabs - 5
Исправление Prisma connection pool timeout через увеличение лимита до 50 и таймаута до 20 секунд - 15
Редизайн корзины в стиле Яндекс Маркета с промокодом, блоком выгоды и новыми компактными карточками товаров - 180
Создание страницы оформления заказа в стиле Яндекс Маркета с выбором способа оплаты (по договору/по счёту) - 120
Добавление расчета НДС (20%) на страницах корзины и оформления заказа - 15
Удаление фотографий товаров из списков на страницах корзины и checkout для упрощения интерфейса - 10
Обновление текста согласия на использование сервиса, удаление блоков безопасной оплаты и гарантии возврата - 5
Исправление URL редиректа с /checkout-new на /checkout для корректной навигации - 5
Добавление блока CatalogSubscribe на страницы корзины и checkout с правильным стилем section-3 - 5
Реализация функционала оплаты по счету: кнопка скачать счет, статус "Ожидает оплаты" на success и в личном кабинете - 30
Создание красивой модалки PriceChangeModal для отображения изменений цен в корзине с детальной информацией о товарах - 45
Исправление ошибок создания заказов: замена clientId на relation API, добавление поля paymentMethod в схему БД - 20
Реализация генерации PDF счетов и хранения в S3: установка @react-pdf/renderer, создание API route с кешированием, загрузка в S3 - 60
Создание компонента InvoicePDF: красивый дизайн счета с поддержкой кириллицы, таблица товаров, расчет НДС, подпись - 90
Исправление отображения на странице успеха: разные заголовки и тексты в зависимости от способа оплаты (invoice/другие) - 15
Исправление статуса заказов по счету: добавление условной установки статуса PENDING для invoice вместо PROCESSING - 5
Добавление скачивания счета из профиля клиента: добавление invoiceUrl в GraphQL запрос GET_ORDERS, обновление интерфейса Order, кнопка скачивания с прямой ссылкой на S3 - 15
Реализация отображения счетов заказов в админке: добавление вкладки "Счета на оплату заказов", создание GET_ORDER_INVOICES query, таблица с номерами заказов и кнопками скачивания - 30
Добавление фильтрации заказов по способу оплаты: добавление параметра paymentMethod в GraphQL схему и resolver orders для поддержки запроса заказов по способу оплаты - 10
Улучшение отображения кнопки скачивания счета в профиле: показ кнопки для всех заказов с paymentMethod=invoice (даже без invoiceUrl), автоматическая генерация через API route, исправление цвета текста на красных кнопках с !text-white, использование inline стилей для надежного отображения - 15
Автоматическая генерация PDF счетов при создании заказа: добавление генерации и загрузки счета в S3 сразу после создания заказа с paymentMethod=invoice в resolver createOrder, сохранение invoiceUrl в БД, счет доступен сразу на странице success и в админке без дополнительных действий - 30
Исправление кнопки скачивания на странице success: замена неверного URL /api/orders на правильный API route CMS, использование inline стилей для видимости белого текста на красном фоне - 10
Рефакторинг системы авторизации: удаление SMS кода, переход на авторизацию по паролю с верификацией менеджером - 420
  - Обновление схемы БД: добавление полей password (hash bcrypt), isVerified (boolean), firstName, lastName, email в модель Client в schema.prisma - 15
  - Обновление GraphQL схемы: добавление мутаций registerClient (с паролем и ФИО), loginWithPassword (номер+пароль), verifyClient (админ подтверждение), типов RegisterInput и LoginInput - 20
  - Создание resolver регистрации: валидация email/телефона, хеширование пароля через bcrypt, создание клиента с isVerified=false, возврат временного токена для отображения плашки ожидания - 30
  - Создание resolver авторизации по паролю: проверка isVerified=true, сравнение bcrypt hash, генерация JWT токена, обработка ошибок (не верифицирован/неверный пароль) - 25
  - Создание resolver верификации клиента (админ): обновление isVerified на true, генерация случайного пароля, отправка email с логином (номер телефона) и паролем через nodemailer/sendgrid - 40
  - Настройка email сервиса: установка nodemailer или интеграция с sendgrid, создание HTML шаблона письма с брендингом, добавление переменных окружения для SMTP - 30
  - Создание страницы верификации в админке: таблица непроверенных клиентов (isVerified=false), отображение ФИО/телефона/email/даты регистрации, кнопка "Подтвердить клиента", фильтры и поиск - 60
  - Обновление формы входа на фронтенде: двухэтапная форма (шаг 1: ввод номера телефона с проверкой существования, шаг 2: ввод пароля с валидацией), удаление всего кода связанного с SMS, обработка ошибок верификации - 50
  - Обновление формы регистрации на фронтенде: добавление полей Имя, Фамилия, Email, Пароль (с подтверждением и индикатором силы), удаление SMS кода, валидация всех полей на клиенте - 45
  - Создание компонента плашки ожидания проверки: красивый UI с иконкой ожидания, текст "Ваша заявка на рассмотрении. Менеджер свяжется с вами в течение 24 часов", кнопка "Вернуться на главную" - 25
  - Создание страницы "Ожидание верификации": полноэкранная страница для неподтвержденных пользователей, показывается при попытке входа, информация о статусе проверки, контакты поддержки - 30
  - Обновление middleware авторизации: проверка isVerified при каждом запросе, редирект на страницу ожидания если false, обработка различных статусов пользователя - 20
  - Миграция существующих клиентов: создание скрипта миграции для установки isVerified=true существующим клиентам, генерация временных паролей, массовая отправка email с паролями - 30
Реализация корзины для неавторизованных пользователей: автоматическое создание анонимных сессий с уникальным ID (anon_<random>_<timestamp>) через localStorage на фронтенде, обновление GraphQL контекста для распознавания и пропуска проверки в БД анонимных клиентов (clientId.startsWith('anon_')), автоматическое создание временного клиента в БД при добавлении в корзину (phone: 'anonymous', isVerified: false), удаление всех проверок авторизации из компонентов добавления в корзину (ProductItemCard, CoreProductCard, BestPriceCard), добавление детального логирования в резолверы и CartContext для отладки, исправление обязательного поля phone в схеме Prisma при создании анонимных клиентов - теперь неавторизованные пользователи могут добавлять товары в корзину, которая сохраняется между сессиями, но не могут оформить заказ без авторизации - 90
Замена alert подтверждения удаления товаров из корзины на красивую модалку: создание универсального компонента ConfirmModal с поддержкой isDangerous режима (красная иконка предупреждения), анимация появления через CSS keyframes, кастомизируемые кнопки подтверждения/отмены, интеграция в CartListNew.tsx с состоянием showConfirmModal, правильное склонение количества товаров (1 товар/2 товара/5 товаров), стилизация в едином стиле с дизайн-системой проекта - 30
Улучшение UX пустой корзины: скрытие правого столбца с итогами при отсутствии товаров через условный рендеринг в cart.tsx, редизайн empty state с красивой анимированной иконкой корзины (плавающая анимация float + пульсация фона), градиентный фон с красными оттенками, увеличенный размер заголовка и описания, добавление CTA кнопки "Перейти в каталог" с иконкой и hover эффектами (поднятие и усиление тени), улучшенная типографика и spacing для более премиального вида - 25
Исправление блокировки сохранения JWT токена в cookies - переименование auth-token на cms-token из-за блокировки браузером - 25
Рефакторинг системы регистрации: переход с номера телефона на email как логин, добавление поля "Название компании" в модель User и все формы регистрации/редактирования, упрощение формы входа до одноэтапной (email+пароль), создание новой страницы регистрации с полями: companyName, firstName, lastName, phone, email, password с баннером "только для юрлиц и ИП", добавление страницы успешной регистрации с информацией об ожидании подтверждения менеджером, обновление админ-панели для отображения companyName в списке пользователей, обновление всех GraphQL схем/resolvers/queries для поддержки companyName - 120
Доработка клиентской авторизации/регистрации: удаление кнопки "Войти по номеру телефона", добавление поля телефона с маской +7 (XXX) XXX-XX-XX в форму регистрации, оптимизация вертикального пространства модалки (уменьшение gaps, height полей, имя/фамилия в grid-cols-2) для устранения скролла, полная замена HTML5 валидации на Zod с кастомными сообщениями через toast.error(), улучшение обработки GraphQL ошибок с извлечением сообщений из graphQLErrors/networkError - 75
Редизайн всплывашки cookies: увеличение размера до 380px, добавление иконки info в красном круге, заголовок + описание, белый текст на красной кнопке "Принять и продолжить", увеличенные отступы и скругления, улучшенная тень и анимация появления - 20
Исправление обработки GraphQL ошибок без Next.js error overlay: удаление console.error из компонентов авторизации, проверка поля errors из Apollo response (errorPolicy: 'all'), вывод GraphQL ошибок через toast.error() вместо catch блока, замена error.errors на error.issues для Zod валидации в LoginByCredentials, установка pdfkit для исправления сборки CMS - 30
Переход с login на email для авторизации клиентов: удаление поля login из Prisma схемы Client, обновление GraphQL схемы (замена login на email в loginByCredentials mutation), исправление resolvers (вход по email, убрана генерация login при подтверждении админом), изменение письма после подтверждения (отправка email+пароль вместо login+пароль), обновление формы LoginByCredentials (замена поля login на email с Mail иконкой, Zod валидация email), обновление GraphQL запроса на frontend, удаление поля login из GET_CLIENT_ME запроса, полное удаление логина из страницы настроек профиля (ProfileSettingsMain, ProfilePersonalData), центрирование заголовков в модалке авторизации, увеличение лимитов Prisma connection pool (100 connections, 60s timeout), добавление graceful shutdown для корректного закрытия подключений - 90
Упрощение формы добавления юрлица - скрытие 3 секций после автозаполнения по ИНН, кнопка "Редактировать вручную" для детальной правки - 20
Исправление ошибки добавления товара в корзину - приведение deliveryTime к строке через String() в ProductPriceHeader, добавление toast уведомлений с названием товара - 5
