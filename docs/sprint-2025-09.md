Доработка хамбургер-меню категорий - фиксированные размеры 600px высота с вертикальным скроллом, двухпанельная компоновка (левая 280px серый фон для списка категорий, правая flex белый фон для подкатегорий), настройка overflow для корректного отображения при большом количестве элементов - 25
Разработка функционала каталога товаров по категориям - создание GraphQL запроса GET_PRODUCTS_BY_CATEGORY, добавление типа в typeDefs.ts, реализация resolver productsByCategory с поиском категории по slug, рекурсивным сбором дочерних категорий, получением товаров с изображениями из БД и PartsIndex API - 45
Создание страницы динамического каталога catalog/[slug].tsx - полная копия функционала new-arrivals с фильтрацией по производителю и цене, сортировкой (популярность/цена/новинки), пагинацией по 24 товара, хлебными крошками, добавлением в корзину с проверкой наличия, обработкой empty state - 60
Интеграция навигации из хамбургер-меню в каталог - рефакторинг handleCategoryClick для перехода на /catalog/[slug], обновление всех точек вызова в мобильной и десктопной версиях меню, добавление закрытия меню после клика - 20
Исправление ошибок TypeScript для сборки проекта - добавление поля links в transformCategoriesToTabData (BottomHead.tsx), добавление type casting для matchingOffer.price с проверкой типа number/string и parseFloat (resolvers.ts) - 10
Исправление критических ошибок сборки проекта - удаление console.log из JSX в BottomHead.tsx:273, добавление интерфейса TabData с полями label/heading/links/categoryId/categorySlug/image/children, добавление типизации для fallbackTabData и transformCategoriesToTabData, добавление импортов PartsIndexCatalog/PartsIndexCatalogsData/PartsIndexCatalogsVariables/NavigationCategory/GET_PARTSINDEX_CATEGORIES/GET_NAVIGATION_CATEGORIES в BottomHeadOld.tsx, добавление типа YandexPickupPoint для параметра map callback в ProfileAddressWayWithMap.tsx:305, успешная финальная сборка проекта - 15
Реализация автозаполнения банковских реквизитов через DaData API - создание API endpoint /api/dadata/bank в CMS для получения данных банка по БИК, интеграция с DaData API (findById/bank), возврат данных о корреспондентском счете и названии банка, настройка CORS headers для работы с frontend - 20
Разработка автоматической генерации названия счета - реализация логики формирования названия счета по формату "последние 4 цифры номера счета + название банка" (например "3456 ПАО СБЕРБАНК"), автоматическое обновление при вводе номера счета или получении данных банка, сохранение сгенерированного названия в базу данных - 15
Рефакторинг формы банковских реквизитов в компоненте LegalEntityBankDetails - реорганизация структуры формы (2 поля для ввода: номер счета и БИК, затем 2 readonly поля: название банка и корр.счет, отдельно readonly поле для сгенерированного названия счета), добавление функции fetchBankDataByBik для автоматического запроса к DaData API при вводе 9 цифр БИК, добавление состояния загрузки fetchingBankData со спиннером, добавление кнопки "Обновить" для повторной загрузки данных банка - 35
Улучшение UX формы реквизитов - добавление визуального разделения readonly полей (серый фон bg-gray-100, cursor-not-allowed), выделение автогенерированного названия счета зеленым цветом с галочкой, условное отображение полей (название банка и корр.счет появляются только после загрузки данных по БИК), блокировка поля БИК во время загрузки данных, toast-уведомления о статусе загрузки - 20
Обновление валидации формы банковских реквизитов - удаление обязательной проверки поля name (генерируется автоматически), сохранение валидации номера счета (20 цифр), БИК (9 цифр), названия банка и корр.счета (20 цифр), добавление fallback генерации названия в handleSubmit если поле пустое, улучшенные сообщения об ошибках - 10
Рефакторинг архитектуры API endpoints - удаление всех DaData API из frontend (/pages/api/dadata/party.ts, /pages/api/dadata/bank.ts), перенос всех внешних API запросов в CMS, обновление компонента LegalEntityBankDetails для использования CMS API через динамический URL (NEXT_PUBLIC_CMS_GRAPHQL_URL), удаление DADATA_API_KEY из .env фронтенда, централизация API ключей в CMS для повышения безопасности - 15
Исправление критической уязвимости безопасности: удаленные пользователи оставались авторизованными - добавление проверки существования клиента в GraphQL resolver clientMe (выброс ошибки CLIENT_NOT_FOUND если клиент удален из БД), добавление валидации существования клиента при создании контекста для всех типов токенов (client_ID_timestamp и JWT), проверка клиента через prisma.client.findUnique в createContext функции GraphQL route.ts - 25
Реализация автоматического logout при удалении пользователя - создание хука useAuthErrorHandler для централизованной обработки ошибок аутентификации, автоматическое удаление токенов из localStorage при получении CLIENT_NOT_FOUND, отправка события authChanged для обновления UI, редирект на главную страницу, интеграция хука в компоненты ProfileSidebar и ProfileLegalEntitiesMain для немедленного разлогинивания удаленных пользователей - 20
Исправление обработки ошибки CLIENT_NOT_FOUND в resolver - добавление проверки типа ошибки в catch блоке clientMe resolver, пробрасывание оригинальной ошибки CLIENT_NOT_FOUND без изменений для корректной обработки на фронтенде (вместо замены на общую ошибку), предотвращение перехвата и замены специфичной ошибки безопасности - 5
Исправление ошибки импорта Prisma в GraphQL route - замена default импорта на именованный импорт { prisma } from '@/lib/prisma' для соответствия экспорту в prisma.ts, устранение ошибки компиляции "Export default doesn't exist in target module" - 3
Исправление проблемы: удалённые пользователи не разлогиниваются - добавление флага clientDeleted в интерфейс Context для явной пометки удалённых клиентов, установка флага clientDeleted=true вместо возврата пустого контекста при отсутствии клиента в БД, добавление проверки context.clientDeleted в resolver clientMe для немедленного выброса ошибки CLIENT_NOT_FOUND, тестирование полного цикла: удаление аккаунта админом → автоматический logout пользователя на фронтенде - 15
Отладка и улучшение обработки ошибок CLIENT_NOT_FOUND - добавление детального логирования в хук useAuthErrorHandler для отслеживания получения и обработки ошибок, логирование всех этапов: получение ошибки, проверка graphQLErrors, обнаружение CLIENT_NOT_FOUND, выполнение logout и редирект, улучшение отладки для выявления проблем с автоматическим разлогиниванием - 5
    19→Исправление критической проблемы: errorPolicy: 'ignore' блокировал обработку ошибок - обнаружение что компонент LKMenu (рендерится на всех страницах профиля) выполнял GET_CLIENT_ME с errorPolicy: 'ignore', что блокировало распространение ошибок CLIENT_NOT_FOUND, изменение errorPolicy на 'all' в LKMenu.tsx:40, добавление импорта и вызова useAuthErrorHandler в LKMenu для корректной обработки ошибок авторизации, успешное тестирование полного цикла автоматического разлогинивания при удалении аккаунта - 10
    20→Улучшение UX формы добавления юридического лица - добавление обработчика onKeyDown для поля ИНН, реализация автоматического запуска функции "Заполнить по ИНН" при нажатии клавиши Enter (при условии что ИНН содержит минимум 10 символов и не идет загрузка), добавление preventDefault для предотвращения submit формы, улучшение пользовательского опыта - теперь не обязательно кликать мышкой на кнопку - 5
    21→Реализация защиты от дублирования юридических лиц - добавление проверки на существование юр. лица с таким же ИНН у клиента перед созданием в обоих resolver'ах (createClientLegalEntity и createClientLegalEntityMe), использование prisma.clientLegalEntity.findFirst с условием clientId + inn, выброс ошибки "Юридическое лицо с таким ИНН уже существует" при попытке создать дубликат, предотвращение создания нескольких юр. лиц с одинаковым ИНН в рамках одного кабинета клиента - 10
    22→Улучшение отображения ошибок при создании/обновлении юридических лиц - изменение обработчиков onError в useMutation для показа конкретного сообщения ошибки от сервера (error.message) вместо общего текста "Ошибка создания юр. лица", теперь пользователь видит точную причину ошибки в toast-уведомлении (например "Юридическое лицо с таким ИНН уже существует"), улучшение UX при валидации данных - 5
    23→Исправление обработки ошибок в resolver createClientLegalEntityMe - изменение catch блока для проброса оригинальной ошибки вместо замены на общее сообщение "Не удалось создать юридическое лицо", добавление проверки instanceof Error для корректного проброса, теперь пользователь видит конкретную причину ошибки (например "Юридическое лицо с таким ИНН уже существует") вместо общего сообщения - 5
    24→Улучшение UX empty state на странице реквизитов - редизайн блока когда нет юридических лиц с добавлением визуальной иконки документов в красном круге, изменение заголовка на "Начните с добавления юридического лица", улучшенное описание "Для добавления банковских реквизитов сначала необходимо создать юридическое лицо. Это займет всего пару минут.", центрирование контента, добавление иконки + к кнопке "Добавить юридическое лицо", улучшение визуальной иерархии и понятности следующего шага для пользователя - 10
    25→Улучшение UX empty state для банковских реквизитов на странице profile-req - редизайн блока в LegalEntityBankDetails.tsx когда у юрлица нет реквизитов (details.length === 0), замена простого текста на визуальный empty state с иконкой пунктирного квадрата и плюса в красном круге bg-red-50, добавление заголовка "Добавьте банковские реквизиты", понятного описания и кнопки "Добавить реквизиты" с иконкой, центрирование контента, теперь пользователю сразу понятно что у юрлица нет реквизитов и что нужно их добавить - 10
    26→Добавление визуальной индикации отсутствия реквизитов в списке юрлиц - изменение кнопки "Реквизиты" для показа статуса: если реквизитов нет (bankDetails.length === 0) - кнопка становится красной с фоном bg-red-50 border-red-200 text-red-600 и текстом "Добавить реквизиты", если есть - показывает "Реквизиты (количество)" с обычным стилем, добавление условной стилизации иконки, теперь пользователю сразу видно какие юрлица требуют добавления реквизитов без необходимости открывать каждое - 10
