Упрощение формы добавления юрлица - скрытие 3 секций после автозаполнения по ИНН, кнопка "Редактировать вручную" для детальной правки - 20
Исправление ошибки добавления товара в корзину - приведение deliveryTime к строке через String() в ProductPriceHeader, добавление toast уведомлений с названием товара - 5
Улучшение валидации API загрузки цен из 1С - добавлена проверка на пустой SKU после нормализации, более понятные сообщения об ошибках - 10
Добавление полей габаритов в API каталога 1С - добавление полей depth (длина), width (ширина), height (высота) в Prisma схему Product, обновление Zod валидации в /api/1c/catalog/products, обработка новых полей в логике создания/обновления товаров, обновление документации на странице интеграции 1C - 15
Исправление отображения иерархии категорий при редактировании товара - добавление рекурсивных функций findCategoriesById и flattenCategories для корректного поиска категорий в дереве, обновление селектора категорий для показа полной иерархии с отступами, теперь категории товара отображаются корректно независимо от уровня вложенности - 10
Добавление блока авторизации для неавторизованных пользователей в корзине - интеграция компонента UnauthenticatedCart с проверкой токена через localStorage, отображение блока "ТОЛЬКО ДЛЯ ЮРЛИЦ" с кнопкой входа и итогами заказа для пользователей с товарами в корзине (правая колонка), создание элегантной карточки с иконкой пользователя, заголовком "Вход для юридических лиц", описанием и кнопкой "Войти в систему" в empty state пустой корзины (светлый градиентный фон, красная рамка, круглая иконка с градиентом), добавление полных CSS стилей для компонента (темный градиентный блок с радиальным красным градиентом для правой колонки, итоги заказа, disabled кнопка оформления, чекбокс согласия) - ОТКАЧЕНО (восстановлено из git) - 35
Исправление определения типа профиля клиента - если у клиента есть хотя бы одно юридическое лицо в legalEntities, общий статус "Тип профиля" показывает "Юр. лицо" вместо "Физ. лицо" - добавлено поле legalEntities (id, shortName, fullName) в GraphQL запрос GET_CLIENTS, обновлен интерфейс Client с добавлением массива legalEntities, переработана функция getClientTypeLabel для проверки наличия юр.лиц перед определением типа, обновлен вызов функции с передачей всего объекта клиента вместо только типа, исправлена ошибка GraphQL "Cannot return null for non-nullable field Client.legalEntities" - добавлен include legalEntities во все resolver'ы возвращающие клиента (clients, client, clientMe, createClient, updateClient, confirmClient), добавлена нормализация данных для гарантии что legalEntities всегда массив а не null, исправлена страница карточки клиента - удален селектор типа пользователя (теперь только для чтения с автоопределением по наличию юр.лиц), удалены устаревшие поля юр.лица из формы общих настроек (ИНН, КПП, ОГРН и т.д.), обновлен заголовок страницы клиента для корректного отображения типа на основе legalEntities, добавлена подсказка показывающая количество юр.лиц - 30
Изменение порядка колонок цен в каталоге товаров - поменяны местами колонки "Цена сайт" и "Цена опт" в таблице ProductList, теперь порядок: Остаток → Цена сайт → Цена опт → Сайт, обновлены заголовки таблицы и ячейки данных - 5
Реорганизация таблицы клиентов - изменена структура колонок (Номер → Тип профиля (ИП/ООО) → ИНН → Наценка → Контактное лицо → Телефон → Email → Дата рег → Статус → Действия), добавлены функции getClientProfileType (определяет ИП или ООО по shortName первого юр.лица) и getClientINN (берет ИНН из первого юр.лица или основного клиента), вся строка таблицы теперь кликабельна с hover эффектом, убрано выпадающее меню с кнопкой редактирования (три точки), убрано синее выделение имени клиента, добавлен stopPropagation для кнопки "Войти от имени", добавлено поле inn в GraphQL запрос legalEntities, обновлен интерфейс Client с полем inn в legalEntities - 20
Добавление модалки подтверждения клиента на дашборде - при клике на неподтвержденного клиента открывается модалка с подтверждением и отправкой письма, при клике на подтвержденного клиента открывается страница редактирования, добавлена мутация CONFIRM_CLIENT, добавлены state (confirmDialogOpen, selectedClient) и функции handleClientClick и handleConfirmClient, карточки клиентов стали кликабельными с cursor-pointer, модалка показывает имя клиента и email для отправки уведомления, toast уведомления об успехе/ошибке, refetch списка клиентов после подтверждения - 25
Оптимизация отображения товаров в корзине - уменьшены отступы (padding: 12px 16px, marginBottom: 8px), удалено дублирование названия товара (убрано описание description, название показывается один раз после бренда/артикула), уменьшены размеры элементов для компактности как в результатах поиска (чекбокс 18px, иконки 18px, кнопки счетчика 24px, шрифты уменьшены на 1-3px), переставлен порядок: сначала бренд/артикул серым текстом 13px, затем название товара 14px жирным, размер цены уменьшен до 17px, border-radius уменьшен до 12px для карточек и 6px для элементов управления - 15
Добавление индикатора количества товара в корзине на странице поиска - заменена зеленая галочка на красный бейдж с числом, показывающий сколько единиц товара уже лежит в корзине, бейдж появляется в правом верхнем углу кнопки "В корзину" для каждого предложения, использует функцию getExistingCartQuantity для подсчета количества, стили: красный фон (#dc2626), белый текст, круглая форма (minWidth: 20px, height: 20px), шрифт 11px жирный, тень для лучшей видимости, tooltip показывает "В корзине: X шт." - 10
Оптимизация размеров сайдбаров и таблицы в каталоге товаров - уменьшен левый сайдбар категорий с w-80 (320px) до w-56 (224px), уменьшен заголовок "Каталог товаров" до "Каталог" (text-base), кнопка "Добавить категорию" стала компактнее (size="sm"), в CategoryTree уменьшены отступы: paddingLeft с level*16+12 до level*12+8, размеры элементов: py-2 -> py-1.5, text-sm -> text-xs, иконки с w-3 h-3 до w-2.5 h-2.5, счетчик товаров text-xs -> text-[10px], оптимизирован grid таблицы ProductList для предотвращения наложения колонок: уменьшены минимальные размеры колонок, увеличен gap с gap-1 до gap-1.5, установлены более разумные minmax значения для каждой колонки, дополнительная оптимизация таблицы - дальнейшее уменьшение всех колонок (чекбокс 26px, внутр.код 55-70px, фото 42-56px, название 110px-1fr, категория 90-180px, артикул 60-80px, остаток 48-65px, цены 55-75px, сайт 42-52px, действия 60-75px), уменьшен gap с 1.5 до 1, уменьшены padding в заголовке (px-2.5 -> px-2) и шрифты (11px -> 10.5px в заголовке, 11.5px -> 11px в строках), уменьшен padding в колонке действий (pr-4 -> pr-2, pr-1.5 -> pr-1), уменьшены кнопки действий (h-8 w-8 -> h-7 w-7, иконки w-4 h-4 -> w-3.5 h-3.5), уменьшен gap между кнопками (gap-1 -> gap-0.5) - 25
Оптимизация номеров клиентов и отображения типа профиля - сокращены номера клиентов до формата CL + 4 цифры (CL1000, CL1001...) для обычных клиентов и AN + 4 цифры (AN1000) для анонимных, обновлена логика генерации в createClient resolver (resolvers.ts:7553-7569) с фильтрацией по префиксу CL и API импорта клиентов (api/clients/import/route.ts:82-94), создан и выполнен скрипт миграции существующих клиентов (scripts/migrate-client-numbers.ts) с преобразованием ANON_ в AN, обновлено 7 клиентов (6 обычных CL1000-CL1005 и 1 анонимный AN1000), переработана функция getClientProfileType для отображения полного названия с типом организации (ИП/ООО/АО/ПАО/ЗАО + название без префикса) вместо просто "ИП" или "ООО", добавлена обработка всех типов организаций с автоматическим удалением дублирующегося префикса из shortName - 30
Оптимизация главной панели дашборда - уменьшены отступы страницы (p-6 -> p-4, space-y-6 -> space-y-4, gap-6 -> gap-4), уменьшены заголовки (h1: text-3xl -> text-2xl, mb-2 -> mb-1), компактнее карточки секций (py-3 вместо стандартных, text-base для заголовков), уменьшены размеры элементов в списках заказов и клиентов (p-4 -> p-3, space-y-4 -> space-y-2, text-sm/text-xs для текста), уменьшены иконки (h-5 w-5 -> h-4 w-4, h-4 w-4 -> h-3 w-3), все карточки статистики сверху теперь кликабельны и ведут на соответствующие страницы (Новые заказы -> /dashboard/orders, Новые клиенты -> /dashboard/clients, Неподтверждённые -> /dashboard/clients?tab=unverified с автоматическим переключением на вкладку "Ожидают проверки", Аналитика -> /dashboard/analytics), добавлен hover эффект для карточек (hover:shadow-md), строки заказов полностью кликабельны (обернуты в Link), добавлен cursor-pointer для всех интерактивных элементов, реализована поддержка URL параметра tab в странице клиентов для автоматического переключения вкладок - 25
Добавление модалки подтверждения клиента в таблицу клиентов - при клике на бейдж статуса "Не подтвержден" открывается модалка подтверждения (аналогично дашборду), добавлена мутация CONFIRM_CLIENT и state управления модалкой (confirmDialogOpen, selectedClient), бейдж "Не подтвержден" стал кликабельным с cursor-pointer и hover эффектом, добавлен stopPropagation для предотвращения перехода на страницу клиента, модалка показывает имя и email клиента, toast уведомления об успехе/ошибке, refetch списка клиентов после подтверждения - 20
Добавление сокращения ФИО в типе профиля клиента - функция getClientProfileType теперь сокращает ФИО для ИП до формата "Фамилия И. О." (например, "ИП Данилов Лев Ильич" отображается как "ИП Данилов Л. И."), добавлена вспомогательная функция abbreviateName для обработки различных форматов имен (1 слово - без изменений, 2 слова - Фамилия И., 3+ слова - Фамилия И. О.), для ООО/АО/ПАО/ЗАО названия остаются без сокращений так как это обычно названия компаний а не ФИО - 10
Добавление счетчиков товаров и цветовой индикации в дерево категорий - добавлено поле _count с подсчетом products во все уровни вложенности категорий в GraphQL запросе GET_CATEGORIES (queries.ts:517-537), обновлен компонент CategoryTree для отображения количества товаров рядом с каждой категорией и подкатегорией, добавлена цветовая индикация для различения категорий с товарами и пустых категорий (категории с товарами: text-gray-700 обычные / text-blue-700 выбранные, счетчик text-gray-500 жирный; пустые категории: text-gray-400 обычные / text-blue-400 выбранные, счетчик text-gray-300), счетчик теперь отображается для всех категорий (даже с 0 товаров) для лучшей визуальной обратной связи - 15
Исправление подсчета товаров в категориях - добавлена рекурсивная функция getTotalProductCount (CategoryTree.tsx:63-67) для подсчета всех товаров включая подкатегории, теперь счетчик показывает общее количество товаров во всей ветке категории а не только прямые товары (например, "Двигатель" теперь показывает сумму товаров из всех подкатегорий: Блок-картер, Головка блока цилиндров, Система смазки и т.д.), обновлена логика определения hasProducts на основе totalProducts - 5
Оптимизация высоты карточек товаров в корзине - уменьшены вертикальные отступы карточки (padding: 12px 16px -> 8px 14px, marginBottom: 8px -> 6px), уменьшен gap между элементами (12px -> 10px), уменьшены размеры текста (brand/article: 13px -> 12px, название: 14px -> 13px, доставка: 12px -> 11px), уменьшены иконки (действия: 18px -> 16px, доставка: 14px -> 12px), уменьшены кнопки счетчика (24px -> 20px, иконки 10px -> 8px, input: 35px -> 30px, fontSize: 13px -> 12px), уменьшены размеры цен (основная цена: 17px -> 15px, старая цена: 12px -> 11px, цена за единицу: 12px -> 11px, скидка: 11px -> 10px), уменьшены отступы между элементами правой части (gap: 8px -> 5px, между кнопками: 6px -> 4px), общее уменьшение высоты карточки примерно на 25-30% - 15
Полная реструктуризация карточки товара в корзине в компактный однострочный формат - изменена структура с вертикальной на горизонтальную (alignItems: flex-start -> center), весь контент теперь размещен в одну строку, уменьшены отступы карточки (padding: 8px 14px -> 6px 12px, marginBottom: 6px -> 4px, borderRadius: 12px -> 8px), уменьшен чекбокс (18px -> 16px), информация о товаре размещена горизонтально с сокращением текста (display: flex, alignItems: center), бренд/артикул и название в одной строке с ellipsis, доставка отображается компактно справа от названия (fontSize: 10px, max-width: 120px), счетчик количества уменьшен (кнопки: 20px -> 18px, input: 30px -> 26px, fontSize: 12px -> 11px, gap: 4px -> 3px), цена и скидка в одну горизонтальную линию (fontSize: 15px -> 14px, старая цена и бейдж скидки рядом), кнопки действий уменьшены (16px -> 14px), общая высота карточки уменьшена примерно на 50% по сравнению с оригиналом - 25
    22→Улучшение кнопки "Все товары" в каталоге - преобразование текстового элемента в полноценную кнопку (компонент Button) с четким визуальным оформлением, добавлена активная синяя подсветка (bg-blue-600) когда кнопка выбрана и outline стиль когда не выбрана, размер sm с полной шириной (w-full) и выравниванием по левому краю (justify-start), добавлен отступ снизу для отделения от списка категорий - 10
    23→Замена иконки подсказки на странице реквизитов - заменена иконка восклицательного знака на иконку лампочки (как в корзине) в компоненте LegalEntityListBlock, добавлена короткая подпись "Подсказка" рядом с иконкой для привлечения внимания, добавлены hover эффекты (transition-colors, group-hover:text-yellow-600) для иконки и текста, изменен цвет иконки с text-yellow-500 на более привлекательный желтый, обновлены оба блока (пустой список и список с юридическими лицами) - 15
    24→
